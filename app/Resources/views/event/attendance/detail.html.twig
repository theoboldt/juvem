{% extends "base.html.twig" %}

{% block title %}Anwesenheitsliste ausfüllen ({{ event.title }}){% endblock %}

{% block body %}
  {% embed 'common/header/base-page-header.html.twig' with {'title': 'Anwesenheitsliste', 'subtitle': 'ausfüllen'} %}
    {% block breadcrumb %}
      <li><a href="{{ path('event_list') }}">Veranstaltungen</a></li>
      <li><a href="{{ path('event', {'eid': event.eid }) }}">{{ event.title }}</a></li>
      <li><a href="{{ path('event_attendance_lists', {'eid': event.eid }) }}">Anwesenheitslisten</a></li>
      <li class="active">{{ list.title }} ausfüllen</li>
    {% endblock %}
  {% endembed %}
  <div class="container">
    <div class="row">
      <div class="col-xs-12">
        <div class="btn-toolbar" role="toolbar">
          <a href="{{ path('event_attendance_list_edit', {eid: event.eid, tid: list.tid}) }}"
             class="btn btn-primary">{{ 'pencil'|glyph }}<span class="hidden-xs"> Bearbeiten</span></a>
          <div class="btn-group" data-toggle="buttons" title="Automatisch aktualisieren" id="autoRefresh">
            <label class="btn btn-info">
              <input type="checkbox" autocomplete="off"> {{ 'repeat'|glyph }} <span
                  class="hidden-xs">aktuell halten</span>
            </label>
          </div>
        </div>
        <nav class="navbar navbar-default attendance-filters">
          {% for column in list.columns %}
            <div class="navbar-form navbar-left">
              <p class="navbar-text">{{ column.title }}</p>
              <div class="btn-group" data-toggle="buttons">
                <label class="btn navbar-btn btn-default active"
                       title="Der Wert der Spalte '{{ column.title }}' soll beim Filtern keine Rolle spielen"
                       data-toggle="tooltip" data-placement="top" data-trigger="hover">
                  <input type="radio" name="column_{{ column.columnId }}" id="group_{{ column.columnId }}_0"
                         data-column-id="{{ column.columnId }}" checked> Alle
                </label>
                {% for choice in column.choices %}
                  <label class="btn navbar-btn btn-default"
                         title="Zeige nur Teilnehmer die beim Feld '{{ column.title }}' keine Option oder '{{ choice.title }}' ausgewählt haben"
                         data-toggle="tooltip" data-placement="top" data-trigger="hover">
                    <input type="radio" name="column_{{ column.columnId }}"
                           id="group_{{ column.columnId }}_{{ choice.choiceId }}"
                           data-column-id="{{ column.columnId }}" data-choice-id="{{ choice.choiceId }}">
                    {{ choice.title }}
                  </label>
                {% endfor %}
              </div>
            </div>
          {% endfor %}
          {% for attribute in event.acquisitionAttributes %}
            {% if attribute.fieldType == 'AppBundle\\Form\\GroupType' %}
              <div class="navbar-form navbar-left">
                <p class="navbar-text">{{ attribute.getManagementTitle(true) }}</p>
                <div class="btn-group" data-toggle="buttons">
                  <label class="btn navbar-btn btn-default active"
                         title="Der Wert des Feldes '{{ attribute.getManagementTitle(true) }}' soll beim Filtern keine Rolle spielen"
                         data-toggle="tooltip" data-placement="top" data-trigger="hover">
                    <input type="radio" name="group_{{ attribute.bid }}" id="group_{{ attribute.bid }}_0"
                           data-bid="{{ attribute.bid }}" checked> Alle
                  </label>
                  {% for choice in attribute.choiceOptions %}
                    {% if not choice.deletedAt %}
                      <label class="btn navbar-btn btn-default"
                             title="Zeige nur Teilnehmer die beim Feld '{{ attribute.getManagementTitle(true) }}' in '{{ choice.getManagementTitle(true) }}' eingeteilt sind"
                             data-toggle="tooltip" data-placement="top" data-trigger="hover"
                             title="Optionen des Einteilungsfeldes '{{ attribute.getManagementTitle(true) }}' anzeigen">
                        <input type="radio" name="group_{{ attribute.bid }}"
                               id="group_{{ attribute.bid }}_{{ choice.id }}" data-bid="{{ attribute.bid }}"
                               data-id="{{ choice.id }}">
                        {{ choice.getManagementTitle(true) }}
                      </label>
                    {% endif %}
                  {% endfor %}
                </div>
              </div>
            {% endif %}
          {% endfor %}
        </nav>

        <table class="table table-striped table-hover" id="attendanceList" data-list-id="{{ list.tid }}"
               data-token="{{ csrf_token('attendance'~list.tid) }}">
        <thead>
          <tr>
            <th>Nachname</th>
            <th>Vorname</th>
            {% for column in list.columns %}
              <th>
                {{ column.title }}<br>
                <div class="btn-group" role="group">
                  <button type="button" class="btn btn-default btn-column-all" data-column-id="{{ column.columnId }}"
                          data-choice-id="0"
                          title="{{ column.title }}: Bei allen sichtbaren Teilnehmern für '{{ column.title }}' keine der Optionen wählen"
                          data-toggle="tooltip" data-placement="top" data-trigger="hover">
                    <i>nichts</i>
                  </button>
                  {% for choice in column.choices %}
                    <button type="button" class="btn btn-default btn-column-all" data-column-id="{{ column.columnId }}"
                            data-choice-id="{{ choice.choiceId }}"
                            title="{{ column.title }}: Bei allen sichtbaren Teilnehmern '{{ choice.title }}' für '{{ column.title }}' wählen"
                            data-toggle="tooltip" data-placement="top" data-trigger="hover">
                      {{ choice.getShortTitle(true) }}
                    </button>
                  {% endfor %}
                </div>
              </th>
            {% endfor %}
          </tr>
          </thead>
          <tbody>
          {% for participant in participants %}
            <tr data-aid="{{ participant.aid }}" id="participant-row-{{ participant.aid }}">
              <td class="name-first">{{ participant.nameLast }}</td>
              <td class="name-last">{{ participant.nameFirst }}</td>
              {% for column in list.columns %}
                <td class="column column-{{ column.columnId }}">
                  <div class="btn-group" data-toggle="buttons">
                    <label class="btn btn-default" title="{{ column.title }}: Keine der Optionen wählen"
                           data-toggle="tooltip"
                           data-placement="top" data-trigger="hover">
                      <input type="radio" name="choice_{{ participant.aid }}_0"
                             id="choice_{{ participant.aid }}_{{ column.columnId }}_0"
                             data-aid="{{ participant.aid }}" data-column-id="{{ column.columnId }}"
                             data-choice-id="0"
                      ><i>nichts</i></label>
                    {% for choice in column.choices %}
                      <label class="btn btn-default" title="{{ column.title }}: {{ choice.title }}"
                             data-toggle="tooltip" data-placement="top" data-trigger="hover">
                        <input type="radio" name="choice_{{ participant.aid }}_{{ column.columnId }}"
                               id="choice_{{ participant.aid }}_{{ column.columnId }}_{{ choice.choiceId }}"
                               data-aid="{{ participant.aid }}" data-column-id="{{ column.columnId }}"
                               data-choice-id="{{ choice.choiceId }}"
                        >
                        {{ choice.getShortTitle(true) }}
                      </label>
                    {% endfor %}
                  </div>
                </td>
              {% endfor %}
            </tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
{% endblock %}
